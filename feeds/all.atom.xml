<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Mike Holzinger</title><link href="https://cipherpop.com/" rel="alternate"></link><link href="https://cipherpop.com/feeds/all.atom.xml" rel="self"></link><id>https://cipherpop.com/</id><updated>2023-11-29T14:50:00-05:00</updated><entry><title>Elevating Container Security with Static Application Security Testing (SAST)</title><link href="https://cipherpop.com/security-scanning-with-sast-in-gitlab-ci.html" rel="alternate"></link><published>2023-11-29T14:50:00-05:00</published><updated>2023-11-29T14:50:00-05:00</updated><author><name>Mike Holzinger</name></author><id>tag:cipherpop.com,2023-11-29:/security-scanning-with-sast-in-gitlab-ci.html</id><summary type="html">&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#introduce-a-web-app-with-weak-code-security-posture"&gt;] Introduce a web app with weak code security posture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#enabling-the-static-application-security-testing-sast-pipeline-template"&gt;] Enabling the Static Application Security Testing (SAST) pipeline template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#run-the-sast-test-job-pipeline-step-against-application-code"&gt;] Run the SAST test job pipeline step against application code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#using-automatically-generated-report-artifacts"&gt;] Using automatically generated report artifacts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#dashboard-project-security"&gt;] Dashboard: Project Security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#dashboard-project-vulnerability"&gt;] Dashboard: Project Vulnerability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#using-the-vulnerability-dashboard-to-confirm-and-resolve-issues"&gt;] Using the Vulnerability dashboard to confirm and resolve issues&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#introducing-a-node-vulnerability-to-the-project"&gt;] Introducing a â€¦&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#introduce-a-web-app-with-weak-code-security-posture"&gt;] Introduce a web app with weak code security posture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#enabling-the-static-application-security-testing-sast-pipeline-template"&gt;] Enabling the Static Application Security Testing (SAST) pipeline template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#run-the-sast-test-job-pipeline-step-against-application-code"&gt;] Run the SAST test job pipeline step against application code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#using-automatically-generated-report-artifacts"&gt;] Using automatically generated report artifacts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#dashboard-project-security"&gt;] Dashboard: Project Security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#dashboard-project-vulnerability"&gt;] Dashboard: Project Vulnerability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#using-the-vulnerability-dashboard-to-confirm-and-resolve-issues"&gt;] Using the Vulnerability dashboard to confirm and resolve issues&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#introducing-a-node-vulnerability-to-the-project"&gt;] Introducing a Node vulnerability to the project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#extend-gitlab-security-scanning-capabilities-with-templates"&gt;] Extend GitLab Security Scanning Capabilities with Templates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#validating-sast-and-newly-added-test-pipeline-jobs"&gt;] Validating SAST and newly added test pipeline jobs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#referencing-vulnerability-dashboard-changes"&gt;] Referencing Vulnerability Dashboard changes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;] Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Why Scan? (A preamble for the middle manager)&lt;/p&gt;
&lt;p&gt;Code security scanning involves analyzing source code for potential vulnerabilities and weaknesses that could be exploited by attackers. This process helps identify and remediate security flaws before they can be used to launch attacks, compromising sensitive data and disrupting business operations.&lt;/p&gt;
&lt;p&gt;Container security scanning, on the other hand, focuses on detecting and mitigating vulnerabilities within container images, the lightweight and portable units of software that form the basis of cloud-native applications.&lt;/p&gt;
&lt;p&gt;Implementing code security and container security scanning into other infrastructure offers several compelling benefits. By automating the process of identifying and addressing vulnerabilities, organizations can significantly reduce their attack surface and enhance their overall security posture. This proactive approach helps prevent data breaches, protect critical assets, and maintain compliance with industry regulations.&lt;/p&gt;
&lt;p&gt;Gitlab offers a comprehensive set of container and security scanning tools, provided free to Gitlab users on every tier, and with Gitlab's Ultimate tier, a set of code vulnerability and security reporting dashboards is also included.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;&lt;em&gt;Official documentation&lt;/em&gt;&lt;/strong&gt;: &lt;a href="https://docs.gitlab.com/ee/user/application_security/sast/"&gt;Static Application Security Testing (SAST)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The scope of this post is to give an example of using the included security scanning tools provided by GitLab first by posting a small Python application with minor code vulnerabilities and then introducing a node.js vulnerability to trigger the Security and Vulnerability dashboards.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="introduce-a-web-app-with-weak-code-security-posture"&gt;] Introduce a web app with weak code security posture&lt;/h1&gt;
&lt;p&gt;Introduced to the project is Python code that uses Flask to host a rest application that returns the Python version and the container OS version from a REST GET request type.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/blob/7a3cc64c256aeb0e12b9d84494f3ca10c0d232d9/app.py"&gt;commit 7A3CC64C (app.py)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;python_version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;platform&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;python_version&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;linux_version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;check_output&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cat /etc/os-release&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Python Version: &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;python_version&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;Linux Version:&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;linux_version&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="enabling-the-static-application-security-testing-sast-pipeline-template"&gt;] Enabling the Static Application Security Testing (SAST) pipeline template&lt;/h1&gt;
&lt;p&gt;This commit step enables the built in Gitlab Static Application Security Testing (SAST) template which will run in the gitlab runner pipeline test job.&lt;/p&gt;
&lt;p&gt;Involved is including the SAST template, to which the adding the pipeline job, &lt;code&gt;test&lt;/code&gt; queues an job in the gitlab runner pipeline execution process. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/blob/5b583d586ff52e6c9222db552f96dbf6774124a7/.gitlab-ci.yml"&gt;commit 5B583D58 (.gitlab-ci.yml)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Items to note:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pipeline job naming&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Enabled and matching pipeline jobs for SAST and GitLab security template(s), require the job step in the GitLab pipeline to be named &lt;code&gt;test:&lt;/code&gt; as subsequent templates are defined as children jobs of the test definition.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Defining the Include stanza&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Typically, these job templates are prepended and commented out in the first commit to &lt;code&gt;.gitlab-ci.yml&lt;/code&gt; and are included by adding a stanza key called "include".&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Each template is listed as a string.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;stages&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;npm_install&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;build&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;test&lt;/span&gt;

&lt;span class="nt"&gt;include&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;SAST.gitlab-ci.yml&lt;/span&gt;

&lt;span class="nt"&gt;sast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;stage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;test&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/analyzer run&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;artifacts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;reports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;sast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;gl-sast-report.json&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="run-the-sast-test-job-pipeline-step-against-application-code"&gt;] Run the SAST test job pipeline step against application code&lt;/h1&gt;
&lt;p&gt;Running the test pipeline job for SAST is an automatic step which is queued and completed by the gitlab runner.&lt;/p&gt;
&lt;p&gt;Output for the pipeline is grouped into the unique pipeline job id.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pipeline job &lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/pipelines/1084491530"&gt;cipherpop-guidance/containerscanning/-/pipelines/1084491530&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="/images/SAST-Setup-initial-sast-scan.jpg" alt="Pipeline Job for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="using-automatically-generated-report-artifacts"&gt;] Using automatically generated report artifacts&lt;/h1&gt;
&lt;p&gt;Artifacts (objects) are associated to finished pipeline jobs regardless of the outcome state. The two jobs triggered from the SAST pipeline execution step are listed here.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nodejs-scan-sast&lt;/li&gt;
&lt;li&gt;semgrep-sast&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This repository has an associated Artifact repository, which GitLab enabled by default for this project.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/artifacts"&gt;cipherpop-guidance/containerscanning/-/artifacts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="/images/SAST-Artifact-generation.jpg" alt="Job Artifacts for SAST test" width="70%" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Artifact naming:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Below is an example artifact name declaration for the sast job step in test.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;gl-sast-report.json&lt;/code&gt; artifact is defined to help illustrate naming reports in the &lt;code&gt;artifacts&lt;/code&gt; stanza.&lt;/p&gt;
&lt;p&gt;This is a default setting that is not neccesary to declare in &lt;code&gt;gitlab-ci.yml&lt;/code&gt; as it is defined in the included SAST pipeline template.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;sast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

&lt;span class="nn"&gt;...&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;artifacts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;reports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;sast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;gl-sast-report.json&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Further report artifact names are listed below to help complete this explanation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;sast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;gl-sast-report.json&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;container_scanning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;gl-container-scanning-report.json&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;dependency_scanning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;gl-dependency-scanning-report.json&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;cyclonedx&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;**/gl-sbom-*.cdx.json&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: In all Gitlab user tiers, the report artifacts are generated, and can be downloaded as JSON objects. Artifacts can be fed to a third-party SEIM without using the Gitlab Vulnerability and Security Dashboards.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="dashboard-project-security"&gt;] Dashboard: Project Security&lt;/h1&gt;
&lt;p&gt;Gitlab Ultimate tier offers dashboard reporting, which interprets the results the SAST job automatically generated Artifacts.&lt;/p&gt;
&lt;p&gt;In this example, the Project Security Dashboard shows that 1 code vulnerability has been flagged as Critical and 3 additional vulnerabilities have been flagged as Medium.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/security/dashboard"&gt;cipherpop-guidance/containerscanning/-/security/dashboard&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="/images/SAST-Security-Dashboard-001.jpg" alt="Security dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;This dashboard is configurable to display vulnerabilities over time with a severity classification.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="dashboard-project-vulnerability"&gt;] Dashboard: Project Vulnerability&lt;/h1&gt;
&lt;p&gt;Let's drill into the details and find out what this Dashboard tries to tell us.&lt;/p&gt;
&lt;p&gt;Drilling into the Vulnerability dashboard, we can see interpreted detail from the &lt;code&gt;gl-sast-report.json&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/security/vulnerability_report"&gt;cipherpop-guidance/containerscanning/-/security/vulnerability_report&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="/images/SAST-Vulnerability-Dashboard-001.jpg" alt="vulnerability dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;Warnings have been issued for lines 3, 10 and 14 of the app.py server code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mi"&gt;03&lt;/span&gt;  &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')&lt;/p&gt;
&lt;p&gt;Description: Consider possible security implications associated with subprocess module.&lt;/p&gt;
&lt;p&gt;Severity: Medium&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mi"&gt;10&lt;/span&gt;  &lt;span class="n"&gt;linux_version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;check_output&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cat /etc/os-release&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')&lt;/p&gt;
&lt;p&gt;Description: Found subprocess function check_output with shell=True. This is dangerous because this call will spawn the command using a shell process. Doing so propagates current shell settings and
variables, which makes it much easier for a malicious actor to execute commands. Use shell=False
instead.&lt;/p&gt;
&lt;p&gt;Severity:  Critical&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mi"&gt;14&lt;/span&gt;  &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Active debug code&lt;/p&gt;
&lt;p&gt;Description The Flask application is running with debug=True configured. By enabling this option, certain exceptions or errors could cause sensitive information to be leaked in HTTP responses.
Additionally, it is not recommended to run a Flask application using Flask.run(...) in production. Instead, a WSGI server such as gunicorn or waitress be used instead. For more information on deployment options for Flask applications see:&lt;/p&gt;
&lt;p&gt;https://flask.palletsprojects.com/en/2.3.x/deploying/&lt;/p&gt;
&lt;p&gt;Severity: Medium&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;] Section summary&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As an overview for SAST code inspection, GitLab's Vulnerability dashboard reports the offending line and offers a comprehensive solution to resolve the identified issue.&lt;/p&gt;
&lt;p&gt;To end this overview, the vulnerability issues are resolved in the following commit:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/commit/5249b3f15c6e04ffb78a8d0fc8efdcb182aca1c0"&gt;commit 5249B3F1 (app.py)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="using-the-vulnerability-dashboard-to-confirm-and-resolve-issues"&gt;] Using the Vulnerability dashboard to confirm and resolve issues&lt;/h1&gt;
&lt;p&gt;With the critical python issue resolved and committed, a pipeline job has been run and shows the new scan results in the Vulnerability Dashboard.&lt;/p&gt;
&lt;p&gt;The Vulnerability Dashboard shows a resolved status and asks for the project operator to "do something" with the posted alert.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/SAST-Vulnerability-Dashboard-002.jpg" alt="vulnerability dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;Next, by marking the &lt;code&gt;Medium&lt;/code&gt; severity vulnerabilities as &lt;code&gt;Confirmed&lt;/code&gt; the Dashboard captures the confirmation state for further management.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/SAST-Vulnerability-Dashboard-003.jpg" alt="vulnerability dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="introducing-a-node-vulnerability-to-the-project"&gt;] Introducing a Node vulnerability to the project&lt;/h1&gt;
&lt;p&gt;In a commit to add template scanning, a node dependency has been introduced to the project with known security issues.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="s2"&gt;&amp;quot;lodash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4.17.10&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/commit/2777c887260c92cffc99af29205c3f8d210d7b5d"&gt;commit 2777C887 (package.json)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Further info on &lt;code&gt;lodash&lt;/code&gt;: &lt;a href="https://security.snyk.io/package/npm/lodash/4.17.10"&gt;Known vulnerabilities in the lodash package&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="extend-gitlab-security-scanning-capabilities-with-templates"&gt;] Extend GitLab Security Scanning Capabilities with Templates&lt;/h1&gt;
&lt;p&gt;Extending the GitLab platform's ability to scan, two templates are added to &lt;code&gt;.gitlab-ci.yml&lt;/code&gt; deepening the depth of a code security defensive strategy.&lt;/p&gt;
&lt;p&gt;Enabled are the following Gitlab security, container and dependancy scanning templates.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;include&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Security/Dependency-Scanning.gitlab-ci.yml&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Security/Container-Scanning.gitlab-ci.yml&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;strong&gt;$CS_IMAGE&lt;/strong&gt; variable has also been set point to the container intended for scanning.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;variables&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;CS_IMAGE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;registry.gitlab.com/cipherpop-guidance/containerscanning:main&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Further documentation on setting container scanning variables is hosted at GitLab:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://docs.gitlab.com/ee/user/application_security/container_scanning/#scan-an-image-in-a-remote-registry"&gt;Container Scanning - Scan an image in a remote registry&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates/Security"&gt;gitlab/ci/templates/Security&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="validating-sast-and-newly-added-test-pipeline-jobs"&gt;] Validating SAST and newly added test pipeline jobs&lt;/h1&gt;
&lt;p&gt;Follwing a code commit, the pipeline to scan for vulnerabilities has triggered and a new series of report artifacts have been generated in concert with the newly added templates to scan the defined container and project dependancies.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/pipelines/1084994991"&gt;cipherpop-guidance/containerscanning/-/pipelines/108499499&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="/images/SAST-Container-Scanning-Pipeline.jpg" alt="vulnerability dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;Completed jobs in the test pipeline job:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/jobs/5616992631"&gt;container_scanning - pipeline test job: 5616992631&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/cipherpop-guidance/containerscanning/-/jobs/5616992630"&gt;gemnasium-python-dependency_scanning - pipeline test job: 5616992630&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="referencing-vulnerability-dashboard-changes"&gt;] Referencing Vulnerability Dashboard changes&lt;/h1&gt;
&lt;p&gt;Following the added code vulnerability, the Vulnerability Dashboard is displaying a staggering set of 5 Critical, 59 High, 224 Medium and 503 Low vulnerability issues from the latest pipeline test scanning job.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/SAST-Vulnerability-Dashboard-004.jpg" alt="vulnerability dash for SAST test" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="summary"&gt;] Summary&lt;/h1&gt;
&lt;p&gt;GitLab SAST, Container Security, and Dependency scanning are potent tools available to all tiers.&lt;/p&gt;
&lt;p&gt;Additionally, early detection of security flaws can save organizations time and resources that would otherwise be spent on incident response and remediation.&lt;/p&gt;
&lt;p&gt;The implementation of code security and container security scanning into code infrastructure is a crucial step towards achieving a comprehensive and effective security strategy. By proactively identifying and addressing vulnerabilities, Code owners and SREs can safeguard data, protect systems, and maintain business continuity.&lt;/p&gt;
&lt;p&gt;More info on security can be found at &lt;a href="http://cipherpop.com"&gt;cipherpop.com&lt;/a&gt;&lt;/p&gt;</content><category term="Security"></category></entry><entry><title>Breaking out of the traditional Docker model in Gitlab</title><link href="https://cipherpop.com/breaking-out-of-docker.html" rel="alternate"></link><published>2023-11-05T10:20:00-05:00</published><updated>2023-11-05T10:20:00-05:00</updated><author><name>Mike Holzinger</name></author><id>tag:cipherpop.com,2023-11-05:/breaking-out-of-docker.html</id><summary type="html">&lt;hr&gt;
&lt;p&gt;Building to deploy docker images using Gitlab CI is a fairly straight forward process to setup and start managing in a few easy steps using a &lt;code&gt;gitlab-ci.yml&lt;/code&gt; file in any repo with a Dockerfile.&lt;/p&gt;
&lt;p&gt;Gitlab suggests built in methods using the gitlab runner to build docker images using a â€¦&lt;/p&gt;</summary><content type="html">&lt;hr&gt;
&lt;p&gt;Building to deploy docker images using Gitlab CI is a fairly straight forward process to setup and start managing in a few easy steps using a &lt;code&gt;gitlab-ci.yml&lt;/code&gt; file in any repo with a Dockerfile.&lt;/p&gt;
&lt;p&gt;Gitlab suggests built in methods using the gitlab runner to build docker images using a Docker-in-docker process (dind) to manage building and deploying images to the artifact registry provided.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;&lt;em&gt;Official documentation:&lt;/em&gt;&lt;/strong&gt; &lt;a href="https://docs.gitlab.com/ee/ci/docker/using_docker_build.html"&gt;Use Docker to build Docker images&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As a project's complexity gradually increases, this adds additional job steps to the Gitlab CI pipeline activity and ultimately slows down building to deploy times.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="our-first-pipeline-commit-job"&gt;] Our first pipeline commit job&lt;/h1&gt;
&lt;p&gt;An example below is using a docker image we will call &lt;code&gt;pythonapp-flask&lt;/code&gt; being built using dind, first then repeating the same steps using a build using kaniko.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;stage&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;stable&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;services&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;dind&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;variables&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;DOCKER_HOST&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2375&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;DOCKER_DRIVER&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overlay2&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;IMAGE_NAME&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;gitlab&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;com&lt;/span&gt;&lt;span class="sr"&gt;/${CI_PROJECT_PATH}/&lt;/span&gt;&lt;span class="n"&gt;pythonapp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;flask&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;before_script&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;$CI_REGISTRY_USER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;$CI_REGISTRY_PASSWORD&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;$CI_REGISTRY&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;$IMAGE_NAME&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;$IMAGE_NAME&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In our first example, we can use the documentation provided steps to build our container and push to our container registery with a given name &lt;code&gt;pythonapp-flask&lt;/code&gt; for our project.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Our source code for the project is here:
- &lt;a href="https://gitlab.com/mholzinger/containerbuilding"&gt;containerbuilding&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;A project job history can be tracked at:
-  &lt;a href="https://gitlab.com/mholzinger/containerbuilding/-/pipelines"&gt;containerbuilding/-/pipelines&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src="/images/DIND-Build-and-push.jpg" alt="Pipeline Job output in gitlab" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="speeding-things-up"&gt;] Speeding things up&lt;/h1&gt;
&lt;p&gt;While the above example only took 52 seconds on average, we can trim even that process down to less than half the time by replacing our docker job with &lt;a href="https://github.com/GoogleContainerTools/kaniko"&gt;Kaniko&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our replaced job logic for our gitlab pipeline uses the kaniko executor project, which has a remarkable extensibility for replacing multiple Docker steps with one stage using the kaniko executor.&lt;/p&gt;
&lt;h4 id="step-one"&gt;Step one ]&lt;/h4&gt;
&lt;p&gt;Our first step with kaniko involves creating a docker config.json file to authenticate to our container registry, the same as we would using a &lt;code&gt;docker login&lt;/code&gt; command. For our example, we are writing the config.json step using bash redirection and storing in our /kaniko/.docker/ path.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo \
&amp;quot;{\&amp;quot;auths\&amp;quot;:{\&amp;quot;$CI_REGISTRY\&amp;quot;:{\&amp;quot;username\&amp;quot;:\&amp;quot;$CI_REGISTRY_USER\&amp;quot;,\&amp;quot;password\&amp;quot;:\&amp;quot;$CI_REGISTRY_PASSWORD\&amp;quot;}}}&amp;quot; \
&lt;span class="k"&gt;&amp;gt; &lt;/span&gt;&lt;span class="ge"&gt;/kaniko/.docker/config.json&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We call this step in the &lt;code&gt;before_script&lt;/code&gt; step in our build stage, and by creating the file using our keys in a local step on the runner in the setup stage, we are skipping an expensive login step which would have added time by calling to the container artifact registry and then writing out a file.&lt;/p&gt;
&lt;h4 id="step-two"&gt;Step two ]&lt;/h4&gt;
&lt;p&gt;The next next step, &lt;code&gt;script:&lt;/code&gt; is invoking a call to &lt;code&gt;kaniko/executor&lt;/code&gt; with a Dockerfile and the container registry and our commit tag as the tag for for the Docker image we build and push.&lt;/p&gt;
&lt;p&gt;We are replacing two previous docker steps, &lt;code&gt;docker build&lt;/code&gt; and &lt;code&gt;docker push&lt;/code&gt; with one command.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stages&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;

&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;stage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gcr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;io&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;kaniko&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;entrypoint&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;variables&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;DOCKER_CONFIG&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;kaniko&lt;/span&gt;&lt;span class="o"&gt;/.&lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;before_script&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;auths&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;:{&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;$CI_REGISTRY&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;:{&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;username&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;$CI_REGISTRY_USER&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;,&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;password&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;$CI_REGISTRY_PASSWORD&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;}}}&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;kaniko&lt;/span&gt;&lt;span class="o"&gt;/.&lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;kaniko&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;CI_PROJECT_DIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;dockerfile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;CI_PROJECT_DIR&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Dockerfile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;destination&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;CI_REGISTRY_IMAGE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;CI_COMMIT_REF_SLUG&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's see this in action.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/Kaniko-Build-and-push.jpg" alt="Kaniko Pipeline Job output in gitlab" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;Summary: In the above example our time to build and deploy was dropped down to just 23 seconds!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="executing-stages-side-by-side"&gt;] Executing stages side by side&lt;/h1&gt;
&lt;p&gt;Finaly doing a real world test and having both steps execute side by side in the same pipeline, dind and kaniko both demostrate consistent execution times for our defined pipeline pipeline jobs, with dind taking nearly one minute and kaniko executor finishing in 24 seconds this time.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/DIND-KANIKO-Build-and-push.jpg" alt="Pipeline Job output in gitlab" style="border: .5px solid #222222;" /&gt;&lt;/p&gt;
&lt;p&gt;The real world benefits for removing the older dind driver model for kaniko executor speak to fast deploy times and reducing cost to one network operation from the gitlab runner to publish to the artifact registry.&lt;/p&gt;</content><category term="Gitlab CI"></category></entry></feed>